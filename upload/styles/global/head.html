{if $smarty.const.THIS_PAGE == 'upload'}

<link href="{$js}/uploadify/uploadify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="{$js}/uploadify/swfobject.js"></script>
<script type="text/javascript" src="{$js}/uploadify/jquery.uploadify.v2.1.4.js"></script>

<script type="text/javascript">
var jsURL = '{$js}';
var uploadError = false;
var file_name = '{$file_name}';
var lang = new Array();
lang['saveData'] = '{lang code='save_data'}';
lang['savingData'] = '{lang code='saving'}';
lang['remoteUploadFile'] = '{lang code="remote_upload_file"}';
lang['upload_video_button'] = '{lang code="upload_video_button"}';
var fileExt = '{$Cbucket->list_extensions()|replace:",":";"}';

var uploadSwfPath = '{$uploaderDetails.uploadSwfPath}';
var uploadScriptPath = '{$uploaderDetails.uploadScriptPath}';

{literal}

  function show_error(msg,ID,fade)
  { $('#file_uploads'+ID+' .percentage')
  	.after('<div class=\"uploadErrorDiv\"><div class=\"uploadErrorMsg\">'+msg+'<\/div><\/div>'); 
	if(fade){$('.uploadSuccessDiv').delay(3000).fadeOut('slow');}
  }
  
  function show_message(msg,ID,fade)
  { $('#uploadForm'+ID)
  	.prepend('<div class=\"uploadSuccessDiv\"><div class=\"uploadSuccessMsg\">'+msg+'<\/div><\/div>');
  if(fade){$('.uploadSuccessDiv').delay(3000).fadeOut('slow');}
  }


function doUpdateVideo(formId,ID)
{
	var formObjectData = $(formId).serialize();
	//alert(serializedData);
	
	$('#updateVideoDataLoading').html('<img src="'+imageurl+'/ajax-loader.gif" />');
	$('#cbSubmitUpload'+ID)
	.attr('disabled','disabled')
	.attr("value",lang.savingData)
	.attr("onClick","return false;");
	
	$.post(
	baseurl+'/actions/file_uploader.php',formObjectData,function(data)
	{
		show_message(data,ID,true);
		$('#updateVideoDataLoading').empty();
		$('#cbSubmitUpload'+ID)
		.attr("disabled","")
		.attr("value",lang.saveData)
		.attr("onClick","doUpdateVideo('#uploadForm"+ID+"','"+ID+"')")
	},"text"
	)
}

$(document).ready(function()
{
  

  var instanceNumber = 0;
  function showUploadify(object)
  {
  $(object).uploadify({
    'uploader'  : uploadSwfPath,
    'script'    : uploadScriptPath,
    'cancelImg' : imageurl+'/cancel_upload.png',
    'auto'      : true,
	'removeCompleted' : false,
	'displayData' : 'both',
	'fileExt'     : fileExt,
	'multi'		  : true,
	'fileDesc'    : 'Video Files',
	'buttonText' : lang.upload_video_button,
	'queueID' : 'fileUploadQueue',
	'queueLimit' : 2,
	'onOpen'	 : function(event,ID,fileObj) {
		
		uploadError = false;
		filename = new Date().getTime() + Math.round((99977 - 10016) * Math.random() + 1) ;
		$.ajax({
			  url: baseurl+'/actions/file_uploader.php',
			  type: "POST",
			  data:({"getForm":"get_form","title":fileObj.name,"objId":ID}),
			  dataType: "text",
			  success: function(data)
			  {
			    if(!uploadError)
				{
					$('#file_uploads'+ID).append(data);
				}
			  }
			});
			
			return true;
	},
	'onComplete' : function(event, ID, fileObj, response, data)
	{
		var resObj = eval('(' + response + ')');
		var vid  = "";
		if(resObj.success=='yes')
		{
			var file_name = resObj.file_name;
			$.ajax({
				  url: baseurl+'/actions/file_uploader.php',
				  type: "POST",
				  data:({"insertVideo":"yes","title":fileObj.name,"file_name":file_name}),
				  dataType: "text",
				  success: function(data)
				  {
					vid = data;
					$("#uploadForm"+ID+" #title").after('<input type="hidden" name="videoid" value="'+vid+'" id="videoid" />')
					.after('<input type="hidden" name="updateVideo" value="yes" id="updateVideo" />');
					$('#cbSubmitUpload'+ID)
					.before('<span id="updateVideoDataLoading" style="margin-right:5px"></span>')
					.attr("disabled","")
					.attr("value",lang.saveData)
					.attr("onClick","doUpdateVideo('#uploadForm"+ID+"','"+ID+"')");
					
					doUpdateVideo('#uploadForm'+ID,ID);
				  }
				});
		}else
		{
			$("#upload_form"+ID).empty().remove();
			show_error(resObj.error,ID,false);	
			uploadError = true;
			return false;
		}
    }
  });
  }
  
  
  showUploadify('#file_uploads');
});

{/literal}
</script>


{else}
<script type="text/javascript">
{literal}
window.onload = function() {
	load_quicklist_box();
	ini_cookies();
}
{/literal}
</script>
{/if}

{if $smarty.const.THIS_PAGE == 'photo_upload'}
<link href="{$js}/uploadify/uploadify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="{$js}/uploadify/swfobject.js"></script>
<script type="text/javascript" src="{$js}/uploadify/jquery.uploadify.v2.1.4.js"></script>

<script type="text/javascript" language="javascript">
var uploadSwfPath = '{$js}/uploadify/uploadify.swf',
 	uploadScriptPath = '{$baseurl}/actions/photo_uploader.php',
	fileExt = '{$cbphoto->extensions()}',
	lang = new Array(),
	pData = new Array();
lang['browsePhrase'] = '{lang code="browse_photos"}';
{literal}

	function photoUploadify(object)
	{
		$(object).uploadify(
		{
			'uploader'  : uploadSwfPath,
			'script'    : uploadScriptPath,
			'fileDataName' : 'photoUpload',
			'cancelImg' : imageurl+'/cancel_upload.png',
			'auto'      : true,
			'removeCompleted' : false,
			'displayData' : 'both',
			'fileExt'     : fileExt,
			'multi'		  : true,
			{/literal}
			{if $smarty.get.collection}
			{assign var=cid value=$cbphoto->decode_key($smarty.get.collection)}
			{if $cbphoto->is_addable($cid)}
			'scriptData' : {ldelim} 'collection':'{$cid}' {rdelim},
			{/if}
			{/if}
			{literal}
			'fileDesc'    : 'Photo Files',
			'buttonText' : lang.browsePhrase,
			'queueID' : 'photoUploadQueue',
			'onComplete' : function(event,ID,fileObj,response,data)
			{
				if(response)
				{ 
					pData.push(response);
					$("#photoIDS").val(pData);
				}
			},
			'onAllComplete': function(event,data) {
				$("#EnterInfo").removeAttr('disabled');
			}
		});
	}
	
$(document).ready(function() { 
	photoUploadify('#photo_uploads'); 
});	
{/literal}
</script>
{/if}

{if $smarty.const.THIS_PAGE == 'view_item'}
<script type="text/javascript">
	var Seo = '{$Cbucket->configs.seo}';
	onReload_item();
</script>
{/if}