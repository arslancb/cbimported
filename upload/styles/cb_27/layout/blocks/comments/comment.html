{if marked_spammed($comment)}
    {assign var='comment_attr' value='style="display:none"'}
    {assign var='spam_attr' value='style="display:block"'}
{else}
{assign var='comment_attr' value=''}
    {assign var='spam_attr' value='style="display:none"'}
{/if}

{if $rep_mode}

<li id="reply-{$comment.comment_id}" class="commentBox clearfix reply-{$comment.comment_id}">
    <div class="replay-holder">
        <div class="users popover-holder clearfix">
            {$user_id = $comment.userid}
            {$user=$userquery->get_user_details($user_id)}
            <a href="{$userquery->profile_link($user)}">
                <img src="{avatar details=$user}" alt="" class="main_pic">
                <span>{name($user)}</span> 
            </a>
        </div>
        <div class="clearfix text-right">
            <i class="text-muted">{$comment.date_added|niceTime}</i>
        </div>
        <div class="reply">
            <div class="sizeSmaller bold" style="font-size:12px;">
                {if !$comment.userid==userid() || has_access('admin_access',true)}
                <a href="javascript:void(0)" onclick="spam_comment('{$comment.comment_id}','{$type}','{$type_id}')">{lang code='spam'}</a>
                {/if}
                {if has_access('admin_del_access') || $comment.userid==userid() || $comment.type_owner_id==userid()} &middot; <a href="javascript:void(0)" onclick="delete_comment('{$comment.comment_id}','{$type}')">{lang code='delete'}</a>{/if}
            </div>
        </div>
        <div class="clearfix">
            {$comment.comment|comment}
        </div>
    </div>
</li>



{elseif $mode == 'reply_box'}

<form name="reply_form" method="post" action="" id="reply_form_{$comment_id}" onsubmit="return false;">
    <input type="hidden" name="reply_to" id="reply_to" value="{$comment_id}">
    <input type="hidden" name="obj_id" id="obj_id" value="{$id}">
    <input type="hidden" name="type" value="{$type}" />
      {ANCHOR place='before_compose_box'}
    <div class="textarea-comment clearfix">
        <textarea name="comment" id="reply_box_{$comment_id}" class="form-control" placeholder="Reply..."></textarea>
        <i class="remove-{$comment_id}" onclick="remove_reply_box({$comment_id})"><span style="color:#e50000"><strong>X</strong></span> Close</i>
    </div>

    <input type="button" name="add_reply" id="add_reply_button_{$comment_id}" class="btn btn-danger pull-right add-reply" onclick="add_comment_js('reply_form_{$comment_id}','{$type}')" value='{lang code="Reply"}'>


</form>

{else}

<li id="comment_{$comment.comment_id}" class="commentBox clearfix"  {$comment_attr}>
    <div class="users popover-holder clearfix">
        
    {$user_id=$comment.userid}
      
    {$user=$userquery->get_user_details($user_id)}
    <a href="{$userquery->profile_link($user)}" >
        <img src="{avatar details=$user}" alt="" class="comnt_pic">
        <span>
            {name($user)}
        </span>
    </a>
        <!-- <i class="text-muted">- {$comment.date_added|niceTime}</i> -->
    </div>
    <div class="clearfix text-right">
        <i class="text-muted">{$comment.date_added|niceTime}</i>
    </div>
    <div class="reply">
        <div class="sizeSmaller bold" style="font-size:12px;">
            {$video = $cbvid->get_video($type_id)}
            {if $myquery->is_commentable($video,'v') && $userquery->login_check('',true)}
            
            <a href="javascript:void(0)" onclick="reply_box('{$comment.comment_id}')">{lang code='reply'}</a>
            {/if}
            {if !$comment.userid==userid() || has_access('admin_access',true)}
            &middot; <a href="javascript:void(0)" onclick="spam_comment('{$comment.comment_id}','{$type}','{$type_id}')">{lang code='spam'}</a>
            {/if}
            {if has_access('admin_del_access') || $comment.userid==userid() || $comment.type_owner_id==userid()} &middot; <a href="javascript:void(0)" onclick="delete_comment('{$comment.comment_id}','{$type}')">{lang code='delete'}</a>{/if}
        </div>
    </div>
     <div class="clearfix">
            {$comment.comment|comment}
    </div>
    <div class="reply-box-{$comment.comment_id} clearfix" style="display:none;">
    </div>
    <ul class="comments-reply-{$comment.comment_id}">

    {if $comment.children}
        {$child_comment = $comment.children}
        {foreach from=$child_comment item=replies}
            {foreach from=$replies|@array_reverse item=reply}
                {if $reply@iteration < 4}
              
                    <li id="reply-{$comment.comment_id}" class="commentBox clearfix reply-{$reply.comment_id}">
                        <div class="replay-holder">
                            <div class="users popover-holder clearfix">
                                {$user_id = $reply.userid}
                                {$user=$userquery->get_user_details($user_id)}
                                <a href="{$userquery->profile_link($user)}">
                                    <img src="{avatar details=$user}" alt="" class="reply_pic">
                                    <span>{name($user)}</span>
                                </a>
                                <!-- <i class="text-muted">- {$reply.date_added|niceTime}</i> -->
                            </div>
                            <div class="clearfix text-right">
                                <i class="text-muted">{$comment.date_added|niceTime}</i>
                            </div>
                            <div class="reply">
                                <div class="sizeSmaller bold" style="font-size:12px;">
                                     {if !$comment.userid==userid() || has_access('admin_access',true)}
                                     <a href="javascript:void(0)" onclick="spam_comment('{$reply.comment_id}','{$type}','{$type_id}')">{lang code='spam'}</a>
                                     {/if}
                                    {if has_access('admin_del_access') || $comment.userid==userid() || $comment.type_owner_id==userid()} &middot; <a href="javascript:void(0)" onclick="delete_comment('{$reply.comment_id}','{$type}')">{lang code='delete'}</a>{/if}
                                </div>
                            </div>
                            <div class="clearfix">
                                {$reply.comment|comment}
                            </div>
                        </div>
                    </li>
                {else}
                {$flag = $comment.comment_id}
                <div class="more-comments-{$comment.comment_id}" style="display:none;">
                    <li id="reply-{$comment.comment_id}" class="commentBox clearfix reply-{$reply.comment_id}">
                        <div class="replay-holder">
                            <div class="users popover-holder clearfix">
                                {$user_id = $reply.userid}
                                {$user=$userquery->get_user_details($user_id)}
                                <a href="{$userquery->profile_link($user)}">
                                    <img src="{avatar details=$user}" alt="" class="reply_pic">
                                    <span>{name($user)}</span>
                                </a>
                                <!-- <i class="text-muted">- {$reply.date_added|niceTime}</i> -->
                            </div>
                            <div class="clearfix text-right">
                                <i class="text-muted">{$comment.date_added|niceTime}</i>
                            </div>
                            <div class="reply">
                                <div class="sizeSmaller bold" style="font-size:12px;">
                                     <a href="javascript:void(0)" onclick="spam_comment('{$reply.comment_id}','{$type}','{$type_id}')">{lang code='spam'}</a>
                                    {if has_access('admin_del_access') || $comment.userid==userid() || $comment.type_owner_id==userid()} &middot; <a href="javascript:void(0)" onclick="delete_comment('{$reply.comment_id}','{$type}')">{lang code='delete'}</a>{/if}
                                </div>
                            </div>
                            <div class="clearfix">
                                {$reply.comment|comment}
                            </div>
                        </div>
                    </li>
                    
                </div>

                {/if} 
            
            {/foreach}
        {/foreach}
           
            


    {/if}
    </ul>
    {if $flag}
    <div class="comments-load-more moad-more-btn-{$flag} clearfix" data-flag="{$flag}">
        <span class="btn btn-danger">More Comments...</span>
    </div>
    {/if}
  
</li>
{/if}





